name: On-demand self-hosted AWS EC2 runner for GitHub Actions
description: GitHub Action for automatic creation and registration AWS EC2 instance as a GitHub Actions self-hosted runner.
author: Elana Zobin, Volodymyr Machula
branding:
  icon: 'box'
  color: 'purple'
inputs:
  mode:
    description: >-
      Specify here which mode you want to use:
        - 'start' - to start a new runner;
        - 'stop' - to stop the previously created runner.
    required: true
  status: 
    description: >-
      status of the workflow. Required for stop mode
    required: false
  github-token:
    description: >-
      GitHub Personal Access Token with the 'repo' scope assigned.
    required: true
  runner-user:
    description: >-
      user to be used as runner of the virtual machine.
    required: true
  runner-home-dir:
    description: >-
      Directory that contains actions-runner software and scripts. E.g. /home/runner/actions-runner.
    required: false
  # label:
  #   description: >-
  #     Name of the unique label assigned to the runner.
  #     The label is used to remove the runner from GitHub when the runner is not needed anymore.
  #     This input is required if you use the 'stop' mode.
  #   required: false
  ec2-image-id:
    description: >-
      EC2 Image Id (AMI). The new runner will be launched from this image.
      This input is required if you use the 'start' mode.
    required: false
  ec2-instance-type:
    description: >-
      EC2 Instance Type. 
      This input is required if you use the 'start' mode.
    required: false
  ec2-subnet-id:
    description: >-
      VPC Subnet Id. The subnet should belong to the same VPC as the specified security group.
      This input is required if you use the 'start' mode.
    required: false
  ec2-security-group-id:
    description: >-
      EC2 Security Group Id. 
      The security group should belong to the same VPC as the specified subnet.
      The runner doesn't require any inbound traffic. However, outbound traffic should be allowed.
      This input is required if you use the 'start' mode.
    required: false
  ec2-instance-id:
    description: >-
      EC2 Instance Id of the created runner.
      The id is used to terminate the EC2 instance when the runner is not needed anymore.
      This input is required if you use the 'stop' mode.
    required: false
  ec2-iam-role-name:
    description: >-
      IAM Role Name to attach to the created EC2 instance.
      This requires additional permissions on the AWS role used to launch instances.
    required: false
  # aws-resource-tags:
  #   description: >-
  #     Tags to attach to the launched EC2 instance and volume.
  #     This must be a stringified array of AWS Tag objects, with both Key and Value fields,
  #     for example: '[{"Key": "TagKey1", "Value": "TagValue1"}, {"Key": "TagKey2", "Value": "TagValue2"}]'
  #   required: false
  #   default: '[]'
  az-subscription-id: 
    description: >-
        Azure secuprity information
    required: false
  az-client-id: 
    description: >-
        Azure secuprity information
    required: false
  az-tenant-id: 
    description: >-
        Azure secuprity information
    required: false
  az-secret: 
    description: >-
        Azure secuprity information
    required: false
  az-image: 
    description: >-
        Image locationand name in the format groupName:imageName
    required: false
  az-location: 
    description: >-
        geolocation , like westus
    required: false
  az-subnet: 
    description: >-
        subnet info in the format N.N.N.N
    required: false
  az-vm-size: 
    description: >-
        one of teh available vm sizes from Asure
    required: false
  az-public-keys: 
    description: >-
        full path to the directory with public keys to supply to VM
    required: false

outputs:
  # label:
  #   description: >-
  #     Name of the unique label assigned to the runner.
  #     The label is used in two cases:
  #     - to use as the input of 'runs-on' property for the following jobs;
  #     - to remove the runner from GitHub when it is not needed anymore.
  ec2-instance-id:
    description: >-
      EC2 Instance Id of the created runner.
      The id is used to terminate the EC2 instance when the runner is not needed anymore.
  run-ons:
    description: >-
      JSON string that contains array of available self-hosted runners 
        {
          ec2: <github runner label>
          azure: <github runner label>
        }
runs:
  using: node16
  main: ./dist/index.js
